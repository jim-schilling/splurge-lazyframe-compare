## Splurge LazyFrame Compare – Action Plan (2025-09-03)

### Objectives
- Improve reliability, performance, and developer experience.
- Align with workspace rules: design, documentation, method, naming, project, python, SDLC, style, and testing standards.

### Prioritized Recommendations

1) Strengthen packaging and CLI ergonomics
- Problem: No CLI entrypoint (`__main__.py` is empty); binary UX limited to import usage.
- Actions:
  - Add `console_scripts` entry in `pyproject.toml` (e.g., `slc = splurge_lazyframe_compare.__main__:main`).
  - Implement `__main__.py` CLI: subcommands compare, report, export; support reading config JSON; explicit keyword-only options for `left`, `right`, `pk_columns`.
  - Provide `--format parquet|csv|json`, `--output-dir`, `--table-format`, `--max-samples`, `--log-level`.
- Acceptance: `pip install -e .` exposes `slc --help`; running compare creates outputs identical to `ReportingService.export_results`.

2) Harden logging defaults and configuration
- Observations: `logging_helpers` sets a stream handler at import-time; prefer consumer-controlled config.
- Actions:
  - Remove module-level handler setup; keep `get_logger` only. Provide `configure_logging(level, fmt)` helper.
  - Respect environment variables (e.g., `SLC_LOG_LEVEL`, `SLC_LOG_FORMAT`).
  - Ensure no duplicate handlers when `basicConfig` is set by applications.
- Acceptance: Importing package does not emit logs unless caller configures; tests verify no duplicate records.

3) File I/O robustness and safety
- Observations: `export_lazyframe` uses atomic writes and path validation; good foundation. Writes NDJSON for json.
- Actions:
  - Add read/import parity (`import_lazyframe`) completion with safe extension inference and schema validation.
  - Expose compression options: parquet (`compression=zstd`), csv (`include_header=True`), json (`new_line=True`).
  - Add large-file chunking guidance in README examples; document backpressure and temp-disk requirements.
- Acceptance: Round-trip tests for all formats; performance test demonstrates parity and integrity.

4) API consistency and keyword-only ergonomics
- Observations: `create_comparison_config_from_lazyframes` already keyword-only; README shows `left_df`, `right_df`.
- Actions:
  - Ensure public service methods use keyword-only for multi-parameter signatures per method standards.
  - Audit for consistent names (`left`, `right`, `pk_columns`) across orchestrator, services, and examples.
- Acceptance: Ruff lint passes; grep shows unified keyword names; tests import and call without positional args.

5) Validation and error reporting clarity
- Observations: Strong custom exceptions; good messages.
- Actions:
  - Ensure all `_handle_error` invocations preserve original exception context and type, with actionable messages.
  - Add guidance in README for interpreting `SchemaValidationError` and PK violations; include remediation steps.
- Acceptance: Tests assert error types and message substrings; README section added.

6) Test coverage and execution speed
- Observations: Solid unit/integration suites; pytest-xdist enabled; no mocks per standards.
- Actions:
  - Add coverage badge generation in CI; target 85%+ for public APIs.
  - Add property-based tests (hypothesis) for schema/mapping round-trips; avoid pandas per project policy.
  - Add performance smoke test for medium datasets gated by `-m perf`.
- Acceptance: Coverage report >=85%; property tests validate invariants; `pytest -m perf` skips by default.

7) CI/CD hardening
- Actions:
  - Add GitHub Actions: lint (ruff), test (py3.10-3.12), build wheels, publish on tagged CalVer.
  - Cache `polars` for CI speed; use `pytest -n auto`.
- Acceptance: Green pipeline across versions; artifacts uploaded on tags.

8) Documentation improvements
- Observations: README is comprehensive; examples good.
- Actions:
  - Add quick “CLI usage” section; add “logging configuration” section; document large-data export tips.
  - Generate simple API docs via `pdoc` or `mkdocs` (optional).
- Acceptance: README sections added; docs site builds locally.

9) Performance profiling hooks
- Actions:
  - Extend `performance_monitor` to optionally capture memory deltas (`tracemalloc`) when enabled.
  - Add opt-in sampling of record counts for expensive operations.
- Acceptance: Config flag toggles memory metrics; logs include memory fields when enabled.

10) Public types and serialization stability
- Actions:
  - Ensure `ComparisonResult` and `ComparisonSummary` have stable, documented fields; add `to_dict()` methods.
  - Provide versioned schema for JSON summary export to ensure compatibility.
- Acceptance: Round-trip JSON summary test; semver bumps documented in changelog.

### Quick Wins (1–2 hours)
- Add CLI skeleton with `--help` and dry-run.
- Remove module-level logging handler; add `configure_logging()`.
- README: add CLI and logging sections.

### Follow-ups
- Add examples using `ComparisonOrchestrator.compare_and_export()` via CLI.
- Introduce `--config` file with env override support (`SPLURGE_`/`SLC_`).
- Provide sample CI workflow yaml under `.github/workflows/`.

### Risks
- Changing logging side-effects could alter downstream behavior; mitigate with clear migration note.
- CLI parameters must mirror API semantics to avoid confusion.

### Migration Notes
- Users should call `logging.basicConfig(...)` or `configure_logging()` in applications after update.
